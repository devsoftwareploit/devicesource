var tab={};function php_beautify(source){if(!tab.editor.getValue().trim().startsWith("<?php"))source="<?php\n"+source;$.get(window.location.origin+'/themes/altum/views/tools-wtlx/php_beautify_api.php',{source:source,global_token:global_token},function(data){tab.editor.setValue(data);});}
function createShiftArr(step){var space='    ';if(isNaN(parseInt(step))){space=step;}else{switch(step){case 1:space=' ';break;case 2:space='  ';break;case 3:space='   ';break;case 4:space='    ';break;case 5:space='     ';break;case 6:space='      ';break;case 7:space='       ';break;case 8:space='        ';break;case 9:space='         ';break;case 10:space='          ';break;case 11:space='           ';break;case 12:space='            ';break;}}
var shift=['\n'];for(var ix=0;ix<100;ix++){shift.push(shift[ix]+space);}
return shift;}
function xml_beautify(source,step){step='\t';var shift=createShiftArr(step);var ar=source.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").replace(/\s*xmlns\=/g,"~::~xmlns=").split('~::~'),len=ar.length,inComment=false,deep=0,str='',ix=0,shift=step?createShiftArr(step):shift;for(ix=0;ix<len;ix++){if(ar[ix].search(/<!/)>-1){str+=shift[deep]+ar[ix];inComment=true;if(ar[ix].search(/-->/)>-1||ar[ix].search(/\]>/)>-1||ar[ix].search(/!DOCTYPE/)>-1){inComment=false;}}else
if(ar[ix].search(/-->/)>-1||ar[ix].search(/\]>/)>-1){str+=ar[ix];inComment=false;}else
if(/^<\w/.exec(ar[ix-1])&&/^<\/\w/.exec(ar[ix])&&/^<[\w:\-\.\,]+/.exec(ar[ix-1])==/^<\/[\w:\-\.\,]+/.exec(ar[ix])[0].replace('/','')){str+=ar[ix];if(!inComment)deep--;}else
if(ar[ix].search(/<\w/)>-1&&ar[ix].search(/<\//)==-1&&ar[ix].search(/\/>/)==-1){str=!inComment?str+=shift[deep++]+ar[ix]:str+=ar[ix];}else
if(ar[ix].search(/<\w/)>-1&&ar[ix].search(/<\//)>-1){str=!inComment?str+=shift[deep]+ar[ix]:str+=ar[ix];}else
if(ar[ix].search(/<\//)>-1){str=!inComment?str+=shift[--deep]+ar[ix]:str+=ar[ix];}else
if(ar[ix].search(/\/>/)>-1){str=!inComment?str+=shift[deep]+ar[ix]:str+=ar[ix];}else
if(ar[ix].search(/<\?/)>-1){str+=shift[deep]+ar[ix];}else
if(ar[ix].search(/xmlns\:/)>-1||ar[ix].search(/xmlns\=/)>-1){str+=shift[deep]+ar[ix];}
else{str+=ar[ix];}}
return(str[0]=='\n')?str.slice(1):str;}
function isSubquery(str,parenthesisLevel){return parenthesisLevel-(str.replace(/\(/g,'').length-str.replace(/\)/g,'').length)}
function split_sql(str,tab){return str.replace(/\s{1,}/g," ").replace(/ AND /ig,"~::~"+tab+tab+"AND ").replace(/ BETWEEN /ig,"~::~"+tab+"BETWEEN ").replace(/ CASE /ig,"~::~"+tab+"CASE ").replace(/ ELSE /ig,"~::~"+tab+"ELSE ").replace(/ END /ig,"~::~"+tab+"END ").replace(/ FROM /ig,"~::~FROM ").replace(/ GROUP\s{1,}BY/ig,"~::~GROUP BY ").replace(/ HAVING /ig,"~::~HAVING ").replace(/ IN /ig," IN ").replace(/ JOIN /ig,"~::~JOIN ").replace(/ CROSS~::~{1,}JOIN /ig,"~::~CROSS JOIN ").replace(/ INNER~::~{1,}JOIN /ig,"~::~INNER JOIN ").replace(/ LEFT~::~{1,}JOIN /ig,"~::~LEFT JOIN ").replace(/ RIGHT~::~{1,}JOIN /ig,"~::~RIGHT JOIN ").replace(/ ON /ig,"~::~"+tab+"ON ").replace(/ OR /ig,"~::~"+tab+tab+"OR ").replace(/ ORDER\s{1,}BY/ig,"~::~ORDER BY ").replace(/ OVER /ig,"~::~"+tab+"OVER ").replace(/\(\s{0,}SELECT /ig,"~::~(SELECT ").replace(/\)\s{0,}SELECT /ig,")~::~SELECT ").replace(/ THEN /ig," THEN~::~"+tab+"").replace(/ UNION /ig,"~::~UNION~::~").replace(/ USING /ig,"~::~USING ").replace(/ WHEN /ig,"~::~"+tab+"WHEN ").replace(/ WHERE /ig,"~::~WHERE ").replace(/ WITH /ig,"~::~WITH ").replace(/ ALL /ig," ALL ").replace(/ AS /ig," AS ").replace(/ ASC /ig," ASC ").replace(/ DESC /ig," DESC ").replace(/ DISTINCT /ig," DISTINCT ").replace(/ EXISTS /ig," EXISTS ").replace(/ NOT /ig," NOT ").replace(/ NULL /ig," NULL ").replace(/ LIKE /ig," LIKE ").replace(/\s{0,}SELECT /ig,"SELECT ").replace(/\s{0,}UPDATE /ig,"UPDATE ").replace(/ SET /ig," SET ").replace(/~::~{1,}/g,"~::~").split('~::~');}
function sql_beautify(source){var ar_by_quote=source.replace(/\s{1,}/g," ").replace(/\'/ig,"~::~\'").split('~::~'),len=ar_by_quote.length,ar=[],deep=0,step='\t',tab=step,inComment=true,inQuote=false,parenthesisLevel=0,str='',ix=0,shift=step?createShiftArr(step):shift;for(ix=0;ix<len;ix++){if(ix%2){ar=ar.concat(ar_by_quote[ix]);}else{ar=ar.concat(split_sql(ar_by_quote[ix],tab));}}
len=ar.length;for(ix=0;ix<len;ix++){parenthesisLevel=isSubquery(ar[ix],parenthesisLevel);if(/\s{0,}\s{0,}SELECT\s{0,}/.exec(ar[ix])){ar[ix]=ar[ix].replace(/\,/g,",\n"+tab+tab+"")}
if(/\s{0,}\s{0,}SET\s{0,}/.exec(ar[ix])){ar[ix]=ar[ix].replace(/\,/g,",\n"+tab+tab+"")}
if(/\s{0,}\(\s{0,}SELECT\s{0,}/.exec(ar[ix])){deep++;str+=shift[deep]+ar[ix];}else
if(/\'/.exec(ar[ix])){if(parenthesisLevel<1&&deep){deep--;}
str+=ar[ix];}
else{str+=shift[deep]+ar[ix];if(parenthesisLevel<1&&deep){deep--;}}
var junk=0;}
str=str.replace(/^\n{1,}/,'').replace(/\n{1,}/g,"\n");return str;}
function beautify(){var source=tab.editor?tab.editor.getValue():$('#code-editor').val(),output;source=source.trimStart();var mode=getMode();if(mode=='htmlmixed'){output=html_beautify(source,{'indent_inner_html':true,'indent_size':4,'indent_char':' ','wrap_line_length':0,'brace_style':'expand','preserve_newlines':true,'indent_handlebars':false});}else if(mode=='javascript'){output=js_beautify(source);validate_json(source);}else if(mode=='css'){output=css_beautify(source);}else if(mode=='xml'){output=xml_beautify(source);}else if(mode=='php'){php_beautify(source);output=tab.editor.getValue();}else if(mode=='text/x-sql'){output=sql_beautify(source);}
if(tab.editor){tab.editor.setValue(output);}else{$('#code-editor').val(output);}}
function html_minify(source){let minifiedhtml=minify(source,{collapseWhitespace:true,removeComments:true});if(minifiedhtml.includes('<style>')){var css_code=source.split('<style>').pop().split('</style>')[0];$.get(window.location.origin+'/themes/altum/views/tools-wtlx/css_minify_api.php',{source:css_code,global_token:global_token},function(data){minifiedhtml=minifiedhtml.replace(/(\r\n|\n|\r)/gm,"");minifiedhtml=minifiedhtml.replace(/(<style>)(.+?)(?=<\/style>)/,"$1"+data);tab.editor.setValue(minifiedhtml);});}
if(minifiedhtml.includes('<script>')){var js_code=source.split('<script>').pop().split('</script>')[0];$.get(window.location.origin+'/themes/altum/views/tools-wtlx/js_minify_api.php',{source:js_code,global_token:global_token},function(data){minifiedhtml=minifiedhtml.replace(/(\r\n|\n|\r)/gm,"");minifiedhtml=minifiedhtml.replace(/(<script>)(.+?)(?=<\/script>)/,"$1"+data);tab.editor.setValue(minifiedhtml);},'text');}
tab.editor.setValue(minifiedhtml);}
function isJsonValid(str){try{JSON.parse(str);}catch(e){return false;}
return true;}
function validate_json(source){console.log($("div.json-validation")[0]);console.log($(".json-validation")[0]);if($("div.json-validation")[0]){console.log(source);if(isJsonValid(source)){$('div.json-validation .alert-success').css('display','block');$('div.json-validation .alert-danger').css('display','none');}else{$('div.json-validation .alert-danger').css('display','block');$('div.json-validation .alert-success').css('display','none');}}else
return;}
function js_minify(source){$.get(window.location.origin+'/themes/altum/views/tools-wtlx/js_minify_api.php',{source:source,global_token:global_token},function(data){tab.editor.setValue(data);},'text');}
function css_minify(source){$.get(window.location.origin+'/themes/altum/views/tools-wtlx/css_minify_api.php',{source:source,global_token:global_token},function(data){tab.editor.setValue(data);});}
function xml_minify(source,preserveComments){var str=preserveComments?source:source.replace(/\<![ \r\n\t]*(--([^\-]|[\r\n]|-[^\-])*--[ \r\n\t]*)\>/g,"").replace(/[ \r\n\t]{1,}xmlns/g,' xmlns');tab.editor.setValue(str.replace(/>\s{0,}</g,"><"));}
function sql_minify(source){tab.editor.setValue(source.replace(/\s{1,}/g," ").replace(/\s{1,}\(/,"(").replace(/\s{1,}\)/,")"));}
function codeminify(){var source=tab.editor?tab.editor.getValue():$('#code-editor').val(),output;tab.editor_old_value=source;$("td.text-danger").text(source.length);var mode=getMode();if(mode=='htmlmixed'){html_minify(source);}else if(mode=='javascript'){js_minify(source);}else if(mode=='css'){css_minify(source);}else if(mode=='xml'){xml_minify(source,false);}else if(mode=='text/x-sql'){sql_minify(source);}}
function getOp(){var url=window.location.pathname;var filename=url.substring(url.lastIndexOf('/')+1);if(filename.includes('minifier'))return codeminify;if(filename.includes('beautifier'))return beautify;}
function getMode(){var url=window.location.pathname;var filename=url.substring(url.lastIndexOf('/')+1);switch(filename){case 'javascript-beautifier':case 'js-minifier':return 'javascript';case 'css-beautifier':case 'css-minifier':return 'css';case 'html-beautifier':case 'html-minifier':return 'htmlmixed';case 'xml-beautifier':case 'xml-minifier':return 'xml';case 'json-validator-beautifier':return 'javascript';case 'opml-beautifier':case 'opml-minifier':return 'xml';case 'java-beautifier':return 'javascript';case 'kotlin-beautifier':return 'javascript';case 'php-beautifier':return 'php';case 'json-minifier':return 'javascript';case 'sql-beautifier':case 'sql-minifier':return 'text/x-sql';default:}}
function get_percentage_change(old_v,new_v){var decreaseValue=old_v-new_v;return((decreaseValue/old_v)*100).toFixed(2);}
function showMinificationTable(){$('.minification-result').css('display','block');tab.editor.save();let perc=get_percentage_change(tab.editor_old_value.length,tab.editor.getValue().length)
$("td.text-success").text(tab.editor.getValue().length+' ('+perc+'%)');}
$('.submit').bind("click",function(){if(getOp()==codeminify)
setTimeout(showMinificationTable,1000);});$(function(){var textArea=$('#code-editor')[0];if(typeof CodeMirror!=='undefined'){tab.editor=CodeMirror.fromTextArea(textArea,{mode:getMode(),theme:'monokai',lineNumbers:true});tab.editor.focus();var default_text='';if(document.documentElement.lang=='en')default_text="// Paste your code here...";if(document.documentElement.lang=='fr')default_text="// Collez ici votre code...";if(document.documentElement.lang=='ar')default_text="...قم بلصق لكود الخاص بك هنا//";tab.editor.setValue(default_text);$('.CodeMirror').click(function(){if(tab.editor.getValue()==default_text){tab.editor.setValue('');}});}
$('.submit').click(getOp());});function clear_editor(){tab.editor.setValue('');}
$('.clear').click(clear_editor);function copy_to_clipbaord(e){if(e.which==1){navigator.clipboard.writeText(tab.editor.getValue());}}
$('.copy-code-wrap').click(copy_to_clipbaord);function download_code(){var textToWrite=tab.editor.getValue();var textFileAsBlob=new Blob([textToWrite],{type:"text/plain;charset=utf-8"});var fileNameToSaveAs="code.txt";var downloadLink=document.createElement("a");downloadLink.download=fileNameToSaveAs;downloadLink.innerHTML="Download File";if(window.webkitURL!=null){downloadLink.href=window.webkitURL.createObjectURL(textFileAsBlob);}else{downloadLink.href=window.URL.createObjectURL(textFileAsBlob);downloadLink.onclick=destroyClickedElement;downloadLink.style.display="none";document.body.appendChild(downloadLink);}
downloadLink.click();}
function destroyClickedElement(event){document.body.removeChild(event.target);}
$('.download-code').click(download_code);$('#fileup').click(function(){$('#files').click();});function loadfile(input){var reader=new FileReader();reader.onload=function(e){tab.editor.setValue(e.target.result);};reader.readAsText(input.files[0]);}
$(document).ready(function(){$("#load-content").click(function(){var site=document.getElementById('website-url').value;$.get(window.location.origin+'/themes/altum/views/tools-wtlx/proxy.php',{site:site,global_token:global_token},function(data){tab.editor.setValue(data);},'html');});});$('.open-new-tab').click(function(){let child=window.open("about:blank","myChild");child.document.write('<pre>'+(tab.editor.getValue()).replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</pre>');child.document.close();});